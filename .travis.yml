language: python
python:
  - "2.7"
  - "3.4"

notifications:
  email: false

before_install:
  # Newer cmake 
  # - sudo add-apt-repository ppa:plfiorini/cmake -y
  # - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  - sudo apt-get update -qq
  - sudo apt-get install nodejs

  - curl -sL https://deb.nodesource.com/setup | sudo bash -
  - sudo apt-get install -y nodejs

  - sudo apt-get install git-core
  - sudo apt-get install default-jre
  # - sudo apt-get install cmake

  # Newer gcc
  # - sudo apt-get install gcc-4.8 g++-4.8
  # - gcc --version
  # - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 80 --slave /usr/bin/g++ g++ /usr/bin/g++-4.8 
  # - sudo update-alternatives --config gcc
  # - gcc --version

  # This version is probably older than desireable . . .
  - sudo apt-get install libmozjs185-1.0 libmozjs185-dev


  # Required by spidermonkey install below
  # - sudo apt-get install autoconf2.13
  # - autoconf --version

  # spidermonkey 
  # - wget http://ftp.mozilla.org/pub/mozilla.org/js/mozjs17.0.0.tar.gz
  # - tar xfz mozjs17.0.0.tar.gz
  # - cd mozjs17.0.0/js/src
  # - autoconf
  # - mkdir build_OPT.OBJ; cd build_OPT.OBJ
  # - ../configure
  # - make -j2

  # Sanity checks
  - gcc --version
  - cmake --version

install:
  # emscripten-fastcomp
  # Download a precompiled fastcomp, unzip etc.
  - cd ~
  - wget http://emscripten-bin.s3-website-us-west-1.amazonaws.com/fastcomp.tar.gz -O - | tar xz

  # Setup the config file.
  - printf "NODE_JS = 'node'\n" >> ~/.emscripten
  - printf "LLVM_ROOT='/home/travis/build/bin'\n" >> ~/.emscripten
  - printf "TEMP_DIR='/tmp'\n" >>  ~/.emscripten
  - printf "COMPILER_ENGINE = NODE_JS\n"  >>  ~/.emscripten
  - printf "JS_ENGINES = [NODE_JS]\n"  >>  ~/.emscripten
  - cat ~/.emscripten
  # "
  - cd -

script: 
  - python emcc -v
  - python tests/runner.py
